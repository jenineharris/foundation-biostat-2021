---
title: 'Foundations of Public Health: Biostatistics'
author: "Week 1 Workshop"
output: html_document
---

# Opening the R packages needed for this workshop

```{r}
# install packages through the Tools menu: tidyverse, haven, table1
# load packages needed for this workshop
library(package = "tidyverse")
library(package = "haven")
library(package = "table1")
```

# Importing the data

* The data can be found on the CDC website and downloaded directly into R from there 
* Downloading data directly 

```{r}
# 2015 Behavioral Risk Factor Surveillance Survey data
temp <- tempfile(fileext = ".zip")
download.file(url  = "https://www.cdc.gov/brfss/annual_data/2015/files/LLCP2015XPT.zip", destfile = temp)
BRFSS_2015 <- read_xpt(file = temp)
```

# Selecting variables of interest

* Search the codebook to learn how these variables were measured:
    + https://www.cdc.gov/brfss/annual_data/2014/pdf/codebook14_llcp.pdf

```{r}
# select sex and transgender identity variables
# and alcohol consumption variables
BRFSS_2015_small <- BRFSS_2015 %>%
   select(SEX, TRNSGNDR, `_RFDRHV5`, `_DRNKWEK`)
```

# Examine the variables of interest

```{r}
# summarize small data set
summary(object = BRFSS_2015_small)
```

# Recoding the sex variable 

```{r}
# add on to the previous data management
BRFSS_2015_small <- BRFSS_2015 %>%
  select(SEX, TRNSGNDR, `_RFDRHV5`, `_DRNKWEK`) %>% 
  mutate(SEX = recode_factor(SEX,
                             '2' = 'male',
                             '1' = 'female'))
  
```

# Checking the work so far

```{r}
# summarize the data frame
summary(object = BRFSS_2015_small)
```

# Recoding the transgender variable

```{r}
# add on to the previous data management
BRFSS_2015_small <- BRFSS_2015 %>%
  select(SEX, TRNSGNDR, `_RFDRHV5`, `_DRNKWEK`) %>%  
  mutate(SEX = recode_factor(SEX,
                             '2' = 'male',
                             '1' = 'female')) %>% 
  mutate(TRNSGNDR = recode_factor(TRNSGNDR,
                                  '1' = 'male-to-female',
                                  '2' = 'female-to-male',
                                  '3' = 'gender non-conforming',
                                  '4' = 'not transgender',
                                  '7' = NA_character_,
                                  '9' = NA_character_)) 
  
```

# Checking the work so far

```{r}
# summarize the data frame
summary(object = BRFSS_2015_small)
```

# You try it!

* Finish the code to recode the heavy drinking variable

```{r}
# add on to the previous data management
BRFSS_2015_small <- BRFSS_2015 %>%
  select(SEX, TRNSGNDR, `_RFDRHV5`, `_DRNKWEK`) %>%  
  mutate(SEX = recode_factor(SEX,
                             '2' = 'male',
                             '1' = 'female')) %>% 
  mutate(TRNSGNDR = recode_factor(TRNSGNDR,
                                  '1' = 'male-to-female',
                                  '2' = 'female-to-male',
                                  '3' = 'gender non-conforming',
                                  '4' = 'not transgender',
                                  '7' = NA_character_,
                                  '9' = NA_character_)) %>% 
  mutate(`_RFDRHV5` = recode_factor(`_RFDRHV5`,
                                    
                                    ))


```

# Checking the work so far

```{r}
# summarize the data frame
summary(object = BRFSS_2015_small)
```

# Recoding other variables 

```{r}
# add on to the previous data management
BRFSS_2015_small <- BRFSS_2015 %>%
  select(SEX, TRNSGNDR, `_RFDRHV5`, `_DRNKWEK`) %>%  
  mutate(SEX = recode_factor(SEX,
                             '2' = 'male',
                             '1' = 'female')) %>% 
  mutate(TRNSGNDR = recode_factor(TRNSGNDR,
                                  '1' = 'male-to-female',
                                  '2' = 'female-to-male',
                                  '3' = 'gender non-conforming',
                                  '4' = 'not transgender',
                                  '7' = NA_character_,
                                  '9' = NA_character_)) %>% 
  mutate(`_RFDRHV5` = recode_factor(`_RFDRHV5`,
                                    '1' = 'no',
                                    '2' = 'yes',
                                    '9' = NA_character_)) %>% 
  mutate(`_DRNKWEK` = as.numeric(`_DRNKWEK`)/100) %>% 
  mutate(`_DRNKWEK` = na_if(`_DRNKWEK`, 999)) %>% 
  rename(sex = SEX) %>% 
  rename(genderIdentity = TRNSGNDR) %>% 
  rename(heavyDrink = `_RFDRHV5`) %>% 
  rename(drinksWeek = `_DRNKWEK`) %>% 
  drop_na()
  
```

# Checking the work so far

```{r}
# summarize the data set
summary(object = BRFSS_2015_small)
```

# Make a table of descriptive statistics

```{r}
# table of all variables
table1(~ sex + genderIdentity + heavyDrink + drinksWeek, 
       data = BRFSS_2015_small)
```

# Add labels to the table

```{r}
# labels for each variable
label(BRFSS_2015_small$sex) = "Participant sex"
label(BRFSS_2015_small$genderIdentity) = "Participant gender identity"
label(BRFSS_2015_small$heavyDrink) = "Participant is heavy drinker"
label(BRFSS_2015_small$drinksWeek) = "Number of alcohol drinks per week"

# table of all variables with labels
table1(~ sex + genderIdentity + heavyDrink + drinksWeek, 
       data = BRFSS_2015_small)
```

# Stratify the table

```{r}
# table of all variables
table1(~ genderIdentity + heavyDrink + drinksWeek | sex, 
       data = BRFSS_2015_small)
```

# You try it! 

* Change the table1 code so that it stratifies by heavyDrink rather than by sex

```{r}
# table of all variables
table1(~ genderIdentity + heavyDrink + drinksWeek | sex, 
       data = BRFSS_2015_small)
```


# Make a graph

```{r}
BRFSS_2015_small %>% 
  filter(genderIdentity %in% c("male-to-female", "female-to-male")) %>% 
  ggplot(aes(x = sex, fill = genderIdentity)) +
  geom_bar()

```

# Make the graph fancier

```{r}
# Add color, labels, grouping, theme
BRFSS_2015_small %>% 
  filter(genderIdentity %in% c("male-to-female", "female-to-male")) %>% 
  ggplot(aes(x = sex, fill = genderIdentity)) +
  geom_bar(position = "dodge") + 
  scale_fill_manual(values = c('#d95f02', '#7570b3')) +
  theme_minimal() +
  labs(x = "Participant sex", y = "Frequency", 
       fill = "Transgender identity")
```


# You try it

* Remove the filter line of code so all people in the BRFSS_2015_small data set are represented in the graph
* Change the fill variable to heavy drinker
* Change the fill colors to other colors 
* Fix any legends and labels to be appropriate for the new variable
* Change the theme (see help documentation for options or https://ggplot2.tidyverse.org/reference/ggtheme.html)

```{r}
# Add color, labels, grouping, theme
BRFSS_2015_small %>% 
  filter(genderIdentity %in% c("male-to-female", "female-to-male")) %>%
  ggplot(aes(x = sex, fill = genderIdentity)) +
  geom_bar(position = "dodge") + 
  scale_fill_manual(values = c('#d95f02', '#7570b3')) +
  theme_minimal() +
  labs(x = "Participant sex", y = "Frequency", 
       fill = "Transgender identity")
```

# The end!


